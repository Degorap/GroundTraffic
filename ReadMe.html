<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <meta content="Animated jetway and docking guidance system for X-Plane scenery package developers">
  <meta content="X-Plane, simulator, scenery" name="keywords">
  <title>GroundTraffic</title>
  <meta content="Jonathan Harris" name="author">
  <style type="text/css">
.banner { font-family: Arial,Helvetica,sans-serif; background-color: lightskyblue; text-align: left; height: 32px; }
.dnl { font-family: Arial,Helvetica,sans-serif; font-size: small; background-color: lightskyblue; }
samp { font-family: Arial,Helvetica,sans-serif; }
h2 { font-family: Arial,Helvetica,sans-serif; }
h3 { font-family: Arial,Helvetica,sans-serif; }
h4 { font-family: Arial,Helvetica,sans-serif; }
h5 { font-family: Arial,Helvetica,sans-serif; }
ul { margin: 0; }
kbd {font-family: sans-serif; color: black; background-color: white; border: 1px solid black; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius: 5px; padding: 1px 1px 0px; }
pre { border: 1px solid; padding: 8px; width: 75%; }
blockquote { font-family: monospace; }
  </style>
</head>
<body>
<table style="width: 100%;" border="0" cellpadding="2">
  <tbody>
    <tr>
      <td class="banner">Marginal&nbsp;&rarr; <a href="http://marginal.org.uk/x-planescenery/">X-Plane Scenery</a>&nbsp;&rarr; <a href="http://marginal.org.uk/x-planescenery/tools.html">Tools</a>&nbsp;&rarr; GroundTraffic</td>
    </tr>
  </tbody>
</table>
<hr>

<h2>GroundTraffic kit for X-Plane<small><sup>&reg;</sup></small></h2>

<h3>Overview</h3>

<p>This kit allows X-Plane scenery designers to add animated ground vehicle traffic to airport scenery packages. It requires X-Plane 10.0 and later.</p>

<h3>How it works</h3>
<p>This kit supplies a plugin that you can distribute with your scenery package. The plugin reads instructions from a text file that you create (and which you should also distribute with your scenery package) and animates X-Plane scenery objects according to those instructions. The objects to be animated can come from X-Plane's built-in library, from an add-on object library (<i>e.g.</i> <a href="http://www.opensceneryx.com/" target="_blank">OpenSceneryX</a>), or from your scenery package.</p>

<h3>Installation</h3>

<ul>
  <li>Create a folder named <samp>plugins</samp> within your scenery package folder.</li>
  <li>Copy the <samp>GroundTraffic</samp> folder from this kit into the <samp>plugins</samp> folder.</li>
</ul>

<h3>Animation instructions</h3>

<p>Use Notepad, TextEdit, or any other text editor to create a plain text file named <samp>GroundTraffic.txt</samp> in your scenery package folder. Save this blank file with an &ldquo;ANSI&rdquo;, &ldquo;Western&rdquo; or &ldquo;UTF-8&rdquo; encoding. (If using TextEdit, you may have to first choose <samp>Format&nbsp;&rarr; Make Plain Text</samp> to see those choices).</p>
<p>Add a &ldquo;Header&rdquo; statement to this file, followed by one or more &ldquo;Routes&rdquo;:</p>

<h4>Header</h4>
<p>The Header statement tells the plugin the location of your airport. It should be of the form &ldquo;ICAO&nbsp;lat&nbsp;lon&rdquo;, where:</p>
<dl>
  <dt>ICAO</dt>
  <dd>Four-character ICAO airport code.</dd>
  <dt>lat &amp; lon</dt>
  <dd>A location near the centre of your airport. The control tower is often a good choice.</dd>
</dl>
<p>For example Seattle-Tacoma airport tower:</p>
<pre>KSEA 	47.4557260 -122.3013928

</pre>

<h4><a name="Route">Route</a></h4>
<p>A Route statement starts a new animation. It should be of the form &ldquo;<code>route</code>&nbsp;speed&nbsp;offset&nbsp;heading&nbsp;object&rdquo;, where:</p>
<dl>
  <dt>speed</dt>
  <dd>The speed of the animated object, in km/h.</dd>
  <dt>offset</dt>
  <dd>Offset in metres to be applied to the object before animation.</dd>
  <dt>heading</dt>
  <dd>Rotation in degrees to be applied to the object before animation.</dd>
  <dt>object</dt>
  <dd>The name of the animated object. This can be the name of a library object from X-Plane's built-in library or from an add-on library, the name of an object in your scenery package, or the name of a &ldquo;<a href="#Train">Train</a>&rdquo;.</dd>
</dl>
<p>For the animation to look correct objects should be modelled such that they are pointing North and are roughly centered at their origin (since the plugin rotates them about their origins).</p>
<ul>
  <li>If using your own objects, design them so they are pointing North (<i>i.e.</i> along the positive green axis in SketchUp or Blender), sitting at or just slightly below ground level to allow for sloped terrain, and centered at or a little forward of their axes' origin. Use <code>0</code> for the &ldquo;offset&rdquo; and &ldquo;heading&rdquo; values in this statement.</li>
  <li>Objects in X-Plane's built-in library tend to be centered at their origin but are not all pointing North; supply a &ldquo;heading&rdquo; value to rotate such objects.</li>
  <li>Objects in the <a href="http://www.opensceneryx.com/" target="_blank">OpenSceneryX</a> library all point North but are not centered at their origin; supply an &ldquo;offset&rdquo; value of at least half the length of the object to correct for this.</li>
  <li>For trains of objects, supply desired &ldquo;offset&rdquo; and &ldquo;heading&rdquo; values in the train <a href="#Train">Car</a> statement; the values supplied here are not used.</p>
</ul>
<p>For example, a route using an object from the scenery package, travelling at 30km/h (~18mph):</p>
<pre>

route	30	0	0	objects/airport_fuel_truck.obj
...</pre>
<p>A route using an object from X-Plane 10's built-in library, travelling at 24km/h (~15mph), to be rotated 180&deg;:</p>
<pre>

route	24	0	180	lib/airport/Ramp_Equipment/Luggage_Truck.obj
...</pre>
<p>The Route statement should be followed by a sequence of &ldquo;waypoints&rdquo; and &ldquo;commands&rdquo;. The Route ends with a blank line.</p>

<h4>Waypoint</h4>
<p>Animated objects move from one waypoint to the next at the speed specified in the Route statement. When the object passes the last waypoint it proceeds towards the first waypoint, forming a circular route (unless you specify a &ldquo;<a href="#reverse">reverse</a>&rdquo; command).</p>
<p>Waypoints should be of the form &ldquo;lat&nbsp;lon&rdquo;. For example:</p>
<pre>...
47.4484450 -122.3001950
...</pre>

<h4>Pause command</h4>
<p>The Pause command instructs the animated object to wait at the preceding waypoint for a while before moving on. It should be of the form &ldquo;<code>pause</code>&nbsp;time&rdquo;, where:</p>
<dl>
  <dt>time</dt>
  <dd>Time to wait, in seconds.</dd>
</dl>
<p>For example, waiting at a waypoint for 30 minutes:</p>
<pre>...
47.4629025 -122.3020905
pause 1800
...</pre>

<h4>At command</h4>
<p>The At command instructs the animated object to wait at the preceeding waypoint until a particular time of day. It should be of the form &ldquo;<code>at</code>&nbsp;HH:MM&nbsp;<code>on</code>&nbsp;days&rdquo;, where:</p>
<dl>
  <dt>HH:MM</dt>
  <dd>Times of day at which to proceed with the animation. Up to 24 times can be specified, in local time, and using a 24 hour clock.</dd>
  <dt>days <i>(optional)</i></dt>
  <dd>Days on which to proceed with the animation. Specified in English.</dd>
</dl>
<p>For example, an animation that waits until 8am:</p>
<pre>...
47.4559849 -122.3028592
at 08:00
...</pre>
<p>An animation that waits until 8am or 8pm on a weekday:</p>
<pre>...
47.4559849 -122.3028592
at 08:00 20:00 on Mon Tue Wed Thu Fri
...</pre>

<h4><a name="reverse">Reverse</a> command</h4>
<p>Normally, when the animated object passes the last waypoint it proceeds towards the first waypoint, forming a circular route. The Reverse command instead instructs the object to change direction at the last waypoint and re-trace its steps. The Reverse command just consists of the word &ldquo;<code>reverse</code>&rdquo; and must be at the end of the Route. For example:</p>
<pre>...
reverse

</pre>

<h4>Comment</h4>
<p>Lines starting with &ldquo;<code>#</code>&rdquo; are treated as comments and are ignored. For example:</p>
<pre># This is a comment</pre>

<h4><a name="Train">Train</a></h4>
<p>Instead of animating a single object along a Route, you can animate a number of objects to follow each other in succession like train cars/coaches follow their locomotive.</p>
<p>A Train statement starts a description of a train of connected objects. It should be of the form &ldquo;<code>train</code>&nbsp;name&rdquo;, where:</p>
<dl>
  <dt>name</dt>
  <dd>The name of your train. Use this name in a Route statement to animate this train. To avoid any ambiguity don't name your train with the same name as a library object or an object in your scenery package.</dd>
</dl>
<p>For example a suitable name for a train consisting of a tug and four luggage carts:</p>
<pre>

train	marginal/luggage_train_4
...</pre>
<p>The Train statement should be followed by a list of the &ldquo;Car&rdquo; statements. The Train description ends with a blank line.</p>

<h4>Car</h4>
<p>A train Car statement should be of the form &ldquo;lag&nbsp;offset&nbsp;heading&nbsp;object&rdquo;, where:</p>
<dl>
  <dt>lag</dt>
  <dd>Distance in metres that the object should lag behind the lead object in the train.</dd>
  <dt>offset</dt>
  <dd>Offset in metres to be applied to the object before animation.</dd>
  <dt>heading</dt>
  <dd>Rotation in degrees to be applied to the object before animation.</dd>
  <dt>object</dt>
  <dd>The name of the animated object. This can be the name of a library object from X-Plane's built-in library or from an add-on library, or the name of an object in your scenery package. It should not be the name of this or another Train.</dd>
</dl>
<p>To determine how far an object should lag behind the the lead object you can open/import the objects in your 3D modelling application and measure how far (in metres) you have to move the object behind the lead object for it to appear to &ldquo;link up&rdquo; correctly. If the object needs an <a href="#Route">offset</a> to be centered on its axes then adjust for this before measuring. Repeat the process for further objects.</p>
<p>For example two objects, the first of which needs to be rotated 180&deg;, the second of which is 3.36m behind the first:</p>
<pre>...
0	0	180	lib/airport/Ramp_Equipment/Luggage_Truck.obj
3.36	0	0	lib/airport/Ramp_Equipment/Luggage_Cart.obj
...</pre>

<h3>Animation DataRefs</h3>

<p>The plugin publishes the following DataRefs that you can use to create animated objects in a 3D modelling application that supports X-Plane animations:</p>
<dl>
  <dt><code>marginal/groundtraffic/distance</code></dt>
  <dd>Distance travelled from the first waypoint, in metres. Resets to zero every time the object passes the first waypoint.</dd>
  <br>
  <dt><code>marginal/groundtraffic/speed</code></dt>
  <dd>Speed of the object, in metres/second. This returns zero if the object is stationary, or up to the speed that you specified in the Route statement (converted to [m/s]) if it is moving.</dd>
  <br>
  <dt><code>marginal/groundtraffic/waypoint/last</code></dt>
  <dd>The last waypoint in the Route (counting from zero) visited by the object.</dd>
  <br>
  <dt><code>marginal/groundtraffic/waypoint/last/distance</code></dt>
  <dd>The distance from the last waypoint, in metres. This returns zero if the object is stationary.</dd>
  <br>
  <dt><code>marginal/groundtraffic/waypoint/next</code></dt>
  <dd>The next waypoint in the Route (counting from zero) visited by the object. This is one greater than the last waypoint unless the object is reversing its route or is circling back to the first waypoint.</dd>
  <br>
  <dt><code>marginal/groundtraffic/waypoint/next/distance</code></dt>
  <dd>The distance to the next waypoint, in metres.</dd>
</dl>
<p>These DataRefs return values specific to the route that the object is following. You can examine these values using <a target="_blank" href="http://developer.x-plane.com/tools/datarefeditor/">DataRefEditor</a>, but it will only display the values for the first route listed in <samp>GroundTraffic.txt</samp>.</p>

<h4>Animating rotating wheels</h4>
<p>The speed of rotation of a wheel depends on its size; a smaller wheel needs to rotate more quickly to cover a given distance than a larger wheel. In your 3D modelling application measure the diameter of the wheel (in metres) and multiple this value by &pi; to obtain the wheel's circumference.</p>
<p>Set up an animation for the wheel containing two keyframes. Rotate the wheel 90&deg; forwards around its axle between the two keyframes. Specify the X-Plane animation values as follows:</p>
<ul>
  <li>DataRef: <code>marginal/groundtraffic/distance</code></li>
  <li>Keyframe#0: DataRef value = 0.</li>
  <li>Keyframe#1: DataRef value = one quarter of the circumference of the wheel [m].</li>
  <li>Loop DataRef value = the circumference of the wheel [m].</li>
</ul>
<p>For example, for a wheel 1.155m in diameter:<p>
<ul>
  <li>DataRef: <code>marginal/groundtraffic/distance</code></li>
  <li>Keyframe#0: DataRef value = 0</li>
  <li>Keyframe#1: DataRef value = 1.155 &times; &pi; &div; 4 = 1.155 &times; 0.7854 = 0.907</li>
  <li>Loop DataRef value = 1.155 &times; &pi; = 1.155 &times; 3.1416 = 3.628</li>
</ul>

<h3>Troubleshooting</h3>

<p>You can check that the plugin has been loaded and is operating correctly by opening the file <samp>Log.txt</samp> in the X-Plane folder. You should see:</p>
<blockquote>Fetching plugins for Custom Scenery/<i>my scenery package</i>/plugins<br>
Loaded: Custom Scenery/<i>my scenery package</i>/plugins/GroundTraffic/mac.xpl.</blockquote>
<p>If the plugin is operating correctly it produces no other output in the log. However if the plugin has a problem reading your <samp>GroundTraffic.txt</samp> file you will see one or more entries starting with &ldquo;GroundTraffic:&rdquo; in the log and the plugin will not perform any animation. For example:</p>
<blockquote>GroundTraffic: Empty route at line 15</blockquote>
<p>The plugin examines your <samp>GroundTraffic.txt</samp> file when you make a selection from the <samp>Location&nbsp;&rarr; Select&nbsp;Global&nbsp;Airport</samp> dialog; if you have edited the file then the plugin will re-read it and re-start the animations. Or you can force the plugin to re-read the file and to re-start the animations by disabling and re-enabling it in the <samp>Plugin&nbsp;&rarr; Plugin&nbsp;Admin&nbsp;&rarr; Enable/Disable</samp> dialog.</p>

<h3>Acknowledgements</h3>

<p>&ldquo;X-Plane&rdquo; is a registered trademark of <a href="http://www.x-plane.com/">Laminar Research</a>.</p>

<h3>License</h3>

<p>This kit is licensed under the Creative Commons <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Attribution</a> license. In short, you can use the plugin provided by this kit in commerical scenery packages, but you must give the author credit.<p>
<p>The author would appreciate a courtesy copy of any commercial scenery that you make using this kit, but you are under no obligation.</p>

<hr>
<table style="width: 100%;" border="0" cellpadding="2">
  <tbody>
    <tr>
      <td class="banner">Version 0.50 &copy; 2013 <a href="mailto:x-plane@marginal.org.uk">Jonathan Harris</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img style="border: 0px solid ; width: 88px; height: 31px; vertical-align: text-bottom;" alt="Creative Commons License" src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a></td>    </tr>
  </tbody>
</table>

</body>
</html>
